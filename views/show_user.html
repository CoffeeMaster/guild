{% extends 'layouts/master.html' %}

{% block embed %}
  <ol class="breadcrumb">
    <li><a href="/">Home</a></li>
    <li>{{ user.uname }}</li>
  </ol>

  <div class="page-header">
    <h1>
      <a href="/users/{{ user.id }}">{{ user.uname }}</a>
      <small>{{ user.role|capitalize}}</small>
      {% if ctx.can(ctx.currUser, 'UPDATE_USER', user) %}
        <a href="/users/{{ user.id }}/edit" class="btn btn-default btn-xs">
          Edit
        </a>
      {% endif %}
    </h1>
  </div>

  <div class="row">
    <div class="col-xs-6">

      <!-- Stats list -->
      <ul>
        <li>Last Seen:
          {% if user.is_ghost %}
            [User enabled ghost mode]
          {% else %}
            {% if user.last_online_at %}
              {% if user.last_online_at.getTime() >= Date.now() - (1000 * 60 * 15) %}
                <span style="color: #3BB878">Online now</span>
              {% else %}
                <abbr class="timeago" title="{{ user.last_online_at.toISOString() }}">
                  {{ user.last_online_at|formatDate }}
                </abbr>
              {% endif %}
            {% else %}
              Hasn't logged in since relaunch
            {% endif %}
          {% endif %}
        </li>
        {% if user.oldguild_uname %}
          <li>Old Guild Username: {{ user.oldguild_uname }}</li>
        {% endif %}
        <li>
          Joined:
          <abbr class="timeago" title="{{ user.created_at.toISOString() }}">
            {{ user.formattedCreatedAt }}
          </abbr>
        </li>
      </ul>

      <!-- Most recent posts -->
      <h3>Most Recent Posts</h3>
      <ul>
        {% for post in recentPosts %}
          <li>
            In <a href="{{ post.url }}">{{ post.topic.title }}</a>
            <abbr class="timeago" title="{{ post.created_at.toISOString() }}">
              {{ post.formattedCreatedAt }}
            </abbr>
          </li>
        {% endfor %}
      </ul>

    </div> <!-- /.col-6 -->

    <!-- Right side -->

    <div class="col-xs-6">
      {% if ctx.can(ctx.currUser, 'CREATE_CONVO') %}
        <a class="btn btn-primary btn-block pull-right"
           href="/convos/new?to={{ encodeURI(user.uname) }}">
          <span class="glyphicon glyphicon-envelope"></span>
          {% if ctx.currUser.id === user.id %}
            Start Private Convo with yourself
          {% else %}
            Start Private Convo with {{ user.uname }}
          {% endif %}
        </a>
      {% endif %}
    </div> <!-- /.col-6 -->

  </div> <!-- /.row -->

{% endblock %}

{% block scripts %}
{% endblock%}
